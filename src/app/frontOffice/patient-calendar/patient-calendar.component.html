<div class="patient-calendar-container">
  <!-- Header section -->
  <div class="calendar-header">
    <h2>My Appointments</h2>
    <p class="calendar-subtitle">View and manage your upcoming appointments</p>
  </div>

  <!-- Notification Container -->
  <div class="notification-container">
    <div *ngIf="errorMessage" class="notification error">
      {{ errorMessage }}
      <button class="close-notification" (click)="errorMessage = null">×</button>
    </div>
    <div *ngIf="successMessage" class="notification success">
      {{ successMessage }}
      <button class="close-notification" (click)="successMessage = null">×</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading your appointments...</p>
  </div>

  <!-- Calendar -->
  <full-calendar *ngIf="!isLoading && !errorMessage" [options]="calendarOptions"></full-calendar>

  <!-- Legend -->
  <div class="calendar-legend">
    <div class="legend-item">
      <div class="legend-color" style="background-color: #ff9f89;"></div>
      <span>Upcoming</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #8fbc8f;"></div>
      <span>Completed</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #cccccc;"></div>
      <span>Cancelled</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #ffeb3b;"></div>
      <span>Reschedule Pending</span>
    </div>
  </div>

  <!-- Appointment Modal -->
  <div *ngIf="isModalOpen" class="modal-backdrop">
    <div class="modal-content patient-modal">
      <div class="modal-header">
        <h3>Appointment Details</h3>
        <button class="close-btn" (click)="closeModal()">×</button>
      </div>

      <div class="modal-body" *ngIf="selectedAppointment">
        <div class="appointment-status" [ngClass]="selectedAppointment.status.toLowerCase()">
          {{ selectedAppointment.status }}
        </div>

        <div class="detail-row">
          <span class="detail-label">Doctor:</span>
          <span class="detail-value">
            Dr. {{ selectedAppointment.professional.firstName }}
            {{ selectedAppointment.professional.lastName }}
          </span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Date & Time:</span>
          <span class="detail-value">{{ formatDate(selectedAppointment.startTime) }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">Duration:</span>
          <span class="detail-value">
            {{
              (selectedAppointment.endTime.getTime() - selectedAppointment.startTime.getTime()) / 60000
            }} minutes
          </span>
        </div>

        <div class="detail-row" *ngIf="selectedAppointment.notes">
          <span class="detail-label">Notes:</span>
          <span class="detail-value">{{ selectedAppointment.notes }}</span>
        </div>

        <!-- Reschedule Reason Input -->
        <div class="detail-row" *ngIf="selectedAppointment.status !== 'CANCELED' && selectedAppointment.status !== 'COMPLETED'">
          <span class="detail-label">Reschedule Reason:</span>
          <textarea
            [(ngModel)]="rescheduleReason"
            placeholder="Enter reason for rescheduling"
            rows="4"
            style="width: 100%;"
          ></textarea>
        </div>

        <!-- Actions -->
        <div class="appointment-actions" *ngIf="selectedAppointment.status !== 'CANCELED' && selectedAppointment.status !== 'COMPLETED'">
          <button
            class="reschedule-btn"
            (click)="requestReschedule()"
            [disabled]="!rescheduleReason.trim()"
          >
            Request Reschedule
          </button>
          <button class="cancel-btn" (click)="cancelAppointment()">
            Cancel Appointment
          </button>
        </div>
      </div>
    </div>
  </div>
</div>