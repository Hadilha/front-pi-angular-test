<app-patient-navbar></app-patient-navbar>
<main class="profile-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Loading your profile...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-state">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ errorMessage }}</p>
    <button class="retry-btn" (click)="loadUserData()">Retry</button>
  </div>

  <!-- Profile Content -->
  <article *ngIf="user && !isLoading" class="profile-card">

    <div class="profile-container">
      <section class="profile-header">
        <!-- Moved profile-identity above the background -->



        <div class="profile-container">
          <section class="profile-header">
            <div class="profile-header__background"
                 [style.background-image]="'url(assets/img/bg1.jpg)'"></div>

            <!-- Profile Identity Section -->
            <div class="profile-identity">
              <div class="profile-avatar">
                <img [src]="user.avatarUrl || 'assets/img/ava.png'"
                     [alt]="user.firstname + ' ' + user.lastname">
              </div>
              <h1 class="patient-name">
                {{ user.firstname }} {{ user.lastname }}
              </h1>
              <div class="patient-meta">
                <span class="patient-id">ID: {{ user.id }}</span>
                <span class="patient-status"
                      [class.active]="user.accountStatus === 'ACTIVE'"
                      [class.inactive]="user.accountStatus !== 'ACTIVE'">
                  {{ (user.accountStatus || 'Active Patient') | titlecase }}
                </span>
              </div>            </div>
          </section>
        </div>








        <!-- Background div moved below but positioned behind -->
        <div class="profile-header__background"
             [style.background-image]="'url(assets/img/bg1.jpg)'"></div>
      </section>
    </div>

      <!-- Medical Summary Grid -->
      <div class="medical-summary">
        <article class="summary-card">
          <div class="summary-icon">
            <i class="fas fa-heartbeat"></i>
          </div>
          <h3 class="summary-title">Last Session</h3>
          <p class="summary-value">
            {{ user.lastSessionDate ? (user.lastSessionDate | date: 'd MMM y') : 'No sessions' }}
          </p>
        </article>

        <article class="summary-card">
          <div class="summary-icon">
            <i class="fas fa-stethoscope"></i>
          </div>
          <h3 class="summary-title">Primary Care</h3>
          <p class="summary-value">
            {{ user.primaryCarePhysician || 'doctor' }}
          </p>
        </article>

        <article class="summary-card">
          <div class="summary-icon">
            <i class="fas fa-clock"></i>
          </div>
          <h3 class="summary-title">Next Appointment</h3>
          <p class="summary-value">
            {{ user.nextAppointment ? (user.nextAppointment | date: 'd MMM y') : 'Not scheduled' }}
          </p>
        </article>
      </div>

      <!-- Health Metrics -->
     <!-- Health Metrics -->
<section class="health-metrics">
  <h2 class="section-title">Health Overview</h2>
  <div class="metrics-grid">
    <div class="metric-item">
      <div class="metric-header">
        <span class="metric-label">Age</span>
        <i class="fas fa-birthday-cake"></i>
      </div>
      <div class="metric-value">
        {{ user.birth ? (calculateAge(user.birth) + ' yrs') : '26' }}
      </div>
    </div>
    <div class="metric-item">
      <div class="metric-header">
        <span class="metric-label">Last Login</span>
        <i class="fas fa-sign-in-alt"></i>
      </div>
      <div class="metric-value">
        {{ user.lastSessionDate ? (user.lastSessionDate | date: 'short') : '1 min ago' }}
      </div>
    </div>
    <div class="metric-item">
      <div class="metric-header">
        <span class="metric-label">Account Status</span>
        <i class="fas fa-user-check"></i>
      </div>
      <div class="metric-value">
        {{ (user.accountStatus || 'Active') | titlecase }}
      </div>
    </div>
    <div class="metric-item">
      <div class="metric-header">
        <span class="metric-label">birth</span>
        <i class="fas fa-calendar-alt"></i>
      </div>
      <div class="metric-value">
        {{ user.birth ? (user.birth | date: 'MMM y') : '01/21/1999' }}
      </div>
    </div>
  </div>
</section>

      <!-- Action Panel -->
      <section class="action-panel">

        <div class="action-group">
          <button class="action-btn primary" (click)="toggleJournal()">
            <i class="fas fa-book-medical"></i>
            Health Journal
          </button>
          <button class="action-btn secondary" (click)="toggleCredentials()">
            <i class="fas fa-user-cog"></i>
            Account Settings
          </button>
        </div>
      </section>

      <!-- Dynamic Components
      <app-journal *ngIf="showJournal"></app-journal>-->
      <app-credentials-patient *ngIf="showCredentials"></app-credentials-patient>

  </article>
</main>
